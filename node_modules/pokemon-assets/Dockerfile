FROM node:16-bullseye

ENV DEBIAN_FRONTEND noninteractive
ENV NPM_VERSION=8.5.0

RUN apt-get update && \
    apt-get install -y git zsh jq imagemagick ffmpeg pandoc && \
    npm install -g "npm@${NPM_VERSION}"

RUN git config --global user.email "noone@noone.local" && \
    git config --global user.name "No one" && \
    mkdir -p ~/.ssh && \
    ssh-keyscan -H github.com >> ~/.ssh/known_hosts

RUN echo 'tag-version-prefix=v' >> ~/.npmrc

COPY ./src/scripts/docker-entrypoint.sh /docker-entrypoint.sh

WORKDIR /usr/src/app

ENTRYPOINT ["/docker-entrypoint.sh"]
